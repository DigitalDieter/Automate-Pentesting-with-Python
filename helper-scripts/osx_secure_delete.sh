GREEN="\033[01;32m"
YELLOW="\033[01;33m"
BLUE="\033[01;34m"
BOLD="\033[01;01m"
RED="\033[01;31m"
RESET="\033[00m"

TMPDIR="tmp"
PATH2SAFE="~/Desktop/"
VOLUMENAME="SECURE_DELETE"
SIZEINMB=100

#PACKAGES="cmake pkg-config fftw libogg libvorbis libsndfile libsamplerate jack sdl stk portaudio node fltk"
PACKAGES="pwgen"
brew install $PACKAGES && true


if [ -d $TMPDIR ];then
echo "Directory already exists"
else
mkdir $TMPDIR
fi


if test -f "$TMPDIR/$VOLUMENAME.dmg"; then
echo "$VOLUMENAME exists! deleting $VOLUMENAME.dmg"
rm "$TMPDIR/$VOLUMENAME.dmg"
fi

#cd $TMPDIR
printf "\n${GREEN}[+] Generating tmp Password for encryption ${RESET} \n"
printf $(pwgen -s 100) > $TMPDIR/tmp_pw.txt
printf "\n${GREEN}[+] Creating encrypted Volume ${RESET} \n"
printf '%s\0' $(cat $TMPDIR/tmp_pw.txt) | hdiutil create -megabytes $SIZEINMB -fs HFS+ -volname $VOLUMENAME "$TMPDIR"/"$VOLUMENAME"  -encryption AES-256  -stdinpass
sleep 3
printf "\n${GREEN}[+] Mounting encrypted Volume ${RESET} \n"
printf '%s\0' $(cat $TMPDIR/tmp_pw.txt)  | hdiutil attach -stdinpass "$TMPDIR/$VOLUMENAME.dmg"
printf "\n${GREEN}[+] Open encrypted Volume ${RESET} \n"
open /Volumes/$VOLUMENAME
printf "\n${GREEN}[+] Moving tmp_pw.txt 2 encrypted Volume ${RESET} \n"
mv $TMPDIR/tmp_pw.txt "/Volumes/"$VOLUMENAME
sleep 3

umount_and_delete() {
printf "\n${RED}[+] Umount encrypted Volume ${RESET} \n"
umount "/Volumes/"$VOLUMENAME
echo "\n${RED}[+] Deleting encrypted Volume ${RESET} \n"
rm "$TMPDIR"/"$VOLUMENAME.dmg"
}

while true; do
printf "\n${RED}Type (y) or (Y) or (n) or (N)  ${RESET} \n"
read -p "Do you wish to umount Volume and delete?" yn
case $yn in
[Yy]* ) umount_and_delete; break;;
[Nn]* ) exit;;
* ) printf "Please answer yes or no.";;
esac
done


